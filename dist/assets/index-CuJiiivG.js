(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}})();const p="https://v2.api.noroff.dev",h="05e991e0-643b-41bd-b4a7-701ca4ae441f",U=`${p}/auth/register`,H=`${p}/auth/login`,k=e=>`${p}/auction/profiles/${e}`;function S(e,n){localStorage.setItem(e,n)}function m(e){return localStorage.getItem(e)}function K(){localStorage.removeItem("accessToken"),localStorage.removeItem("userEmail")}async function X(){const e=m("username"),n=m("accessToken"),r=document.getElementById("myBidsSection");if(!(!e||!n||!r))try{const o=await fetch(`${p}/auction/profiles/${e}/bids?_listings=true`,{headers:{Authorization:`Bearer ${n}`,"X-Noroff-API-Key":h}}),{data:t}=await o.json(),s=new Map;t.forEach(a=>{const d=a.listing.id,c=s.get(d);(!c||new Date(a.created)>new Date(c.created))&&s.set(d,a)});const i=Array.from(s.values());if(i.length===0){r.innerHTML="<p class='text-center'>You haven't placed any bids yet.</p>";return}r.innerHTML=i.map(a=>{var y,w,C,N;const d=((w=(y=a.listing.media)==null?void 0:y[0])==null?void 0:w.url)||"https://via.placeholder.com/300x300?text=Auction",c=a.listing.title||"Untitled",l=a.amount,u=new Date(a.created).toLocaleString(),g=((N=(C=a.listing.media)==null?void 0:C[0])==null?void 0:N.alt)||c;return`
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm">
            <img src="${d}" class="card-img-top object-fit-cover" style="height: 200px;" alt="${g}" />
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${c}</h5>
              <p><strong>Your bid:</strong> $${l}</p>
              <p><strong>Bid placed:</strong> ${u}</p>
              <a href="/pages/auctionDetail.html?id=${a.listing.id}" class="btn btn-primary mt-auto fw-bold">View Auction</a>
            </div>
          </div>
        </div>
      `}).join("")}catch(o){console.error("Error fetching user bids:",o),r.innerHTML="<p class='text-danger'>Could not load your bids.</p>"}}function T(){if(document.getElementById("loading-indicator"))return;const e=document.createElement("div");e.id="loading-indicator",e.innerHTML=`
      <div class="spinner-overlay">
        <div class="spinner"></div>
      </div>
    `,document.body.appendChild(e)}function B(){const e=document.getElementById("loading-indicator");e&&document.body.removeChild(e)}async function L(){var r,o;const e=m("username"),n=m("accessToken");if(!e||!n){console.error("Missing username or token. User is not logged in.");return}T();try{const t=await fetch(`${p}/auction/profiles/${e}`,{headers:{Authorization:`Bearer ${n}`,"X-Noroff-API-Key":h}}),{data:s}=await t.json(),i=document.getElementById("profileUsername");i&&(i.textContent=s.name||"Username");const a=document.getElementById("profileEmail");a&&(a.textContent=s.email||"Email not found");const d=document.getElementById("profileCredits");d&&(d.textContent=s.credits||0);const c=document.getElementById("profileBio");c&&(c.textContent=s.bio||"No bio yet");const l=document.getElementById("profileAvatar");l&&(l.src=((r=s.avatar)==null?void 0:r.url)||"https://via.placeholder.com/300x300?text=Avatar",l.alt=((o=s.avatar)==null?void 0:o.alt)||"User avatar");const u=document.getElementById("credits");u&&(u.textContent=`Credits: ${s.credits}`)}catch(t){console.error("Error retrieving user profile:",t)}finally{B()}}L();X();async function F(e,n){var r,o;try{const t=await fetch(H,{method:"POST",headers:{"Content-Type":"application/json","X-Noroff-API-Key":h},body:JSON.stringify({email:e,password:n})}),s=await t.json();if(!t.ok)throw new Error(`Login failed with status ${t.status}`);const i=(r=s.data)==null?void 0:r.accessToken,a=(o=s.data)==null?void 0:o.name;if(!i)throw new Error("Did not receive token from the API");S("accessToken",i),S("userEmail",e),S("username",a),await L(a),window.location.href="index.html"}catch(t){throw console.error("Error logging in:",t),t}}async function Y(e){try{const n=await fetch(U,{method:"POST",headers:{"Content-Type":"application/json","X-Noroff-API-Key":h},body:JSON.stringify(e)}),r=await n.json();if(!n.ok)throw new Error(`Registration failed with status ${n.status}`);await L(e.name),window.location.href="index.html"}catch(n){throw n}}function f(e,n,r="info"){const o=document.querySelector(e);o&&(o.classList.remove("d-none"),o.innerHTML=`
      <div class="alert alert-${r} mt-2" role="alert">
        ${n}
      </div>
    `)}document.querySelector("#login-form").addEventListener("submit",async e=>{e.preventDefault();const n=document.querySelector("#login-email").value,r=document.querySelector("#login-password").value;try{await F(n,r),f("#login-error","Login successful! Redirecting...","success"),setTimeout(()=>{const o=bootstrap.Modal.getInstance(document.getElementById("loginModal"));o&&o.hide()},2e3)}catch{f("#login-error","Login failed. Please check your credentials.","danger")}});function z(){K(),f("#logout-message","You have successfully logged out.","success"),navigator.userAgent.includes("Playwright")||setTimeout(()=>{const n=bootstrap.Modal.getInstance(document.getElementById("logoutModal"));n&&n.hide(),window.location.href="/index.html"},2e3)}function J(){const e=document.querySelector("#confirm-logout");e&&e.addEventListener("click",z)}J();document.querySelector("#registration-form").addEventListener("submit",async e=>{e.preventDefault();const n=document.querySelector("#register-name").value,r=document.querySelector("#register-email").value,o=document.querySelector("#register-password").value,t={name:n,email:r,password:o};try{await Y(t),f("#register-error","Registration successful! You can now log in.","success"),setTimeout(()=>{bootstrap.Modal.getInstance(document.getElementById("registerModal")).hide()},2e3)}catch{f("#register-error","Registration failed. Please check your inputs.","danger")}});function W(e){var s,i;const n=document.querySelector("#customCarouselWrapper");if(!n||!e.length)return;n.innerHTML="",e.forEach(a=>{var l,u;const d=((u=(l=a.media)==null?void 0:l[0])==null?void 0:u.url)||"https://via.placeholder.com/800x400?text=No+Image",c=document.createElement("div");c.className="carousel-slide",c.innerHTML=`
      <a href="/pages/auctionDetail.html?id=${a.id}">
        <img src="${d}" alt="${a.title}" />
      </a>
    `,n.appendChild(c)});const r=n.querySelectorAll(".carousel-slide");let o=1;function t(){r.forEach((d,c)=>{d.classList.toggle("active",c===o)});const a=r[0].offsetWidth+16;n.scrollTo({left:o*a,behavior:"smooth"})}(s=document.getElementById("prevBtn"))==null||s.addEventListener("click",()=>{o>0&&(o--,t())}),(i=document.getElementById("nextBtn"))==null||i.addEventListener("click",()=>{o<r.length-1&&(o++,t())}),t()}async function O(){const e=m("username"),n=m("accessToken");if(!(!e||!n))try{const r=await fetch(`${k(e)}/listings?_sort=endsAt&sortOrder=asc&_bids=true`,{headers:{Authorization:`Bearer ${n}`,"X-Noroff-API-Key":h}}),{data:o}=await r.json(),t=o.filter(s=>{var i;return((i=s.media)==null?void 0:i.length)>0});W(t.slice(0,5))}catch(r){console.error("Error retrieving your 'Last Chance' auctions:",r)}}O();document.addEventListener("DOMContentLoaded",()=>{localStorage.getItem("username")&&L(),O()});const D=document.querySelector("#listing-container"),j=document.querySelector("#loadMoreBtn"),A=m("username"),E=m("accessToken");let b=[],v=[],I=!1;function q(e){const n=new Date,o=new Date(e)-n;if(o<=0)return"Ended";const t=Math.floor(o/(1e3*60*60*24)),s=Math.floor(o/(1e3*60*60)%24),i=Math.floor(o/(1e3*60)%60),a=Math.floor(o/1e3%60);return`${t}d ${s}h ${i}m ${a}s`}async function _(){if(!E||!A){b=[],T(),await P(),B();return}T();try{const e=await fetch(`${k(A)}/listings?_sort=created&sortOrder=desc&_bids=true`,{headers:{Authorization:`Bearer ${E}`,"X-Noroff-API-Key":h}}),{data:n}=await e.json();b=n.slice(0,9),await P()}catch(e){console.error("Error retrieving user's auctions:",e)}finally{B()}}async function P(){try{const e=await fetch(`${p}/auction/listings?_sort=created&sortOrder=desc&_bids=true&_seller=true&limit=100`,{headers:{"X-Noroff-API-Key":h}}),{data:n}=await e.json();A?v=n.filter(r=>{var o;return((o=r.seller)==null?void 0:o.name)!==A}):v=n,x()}catch(e){console.error("Error retrieving other people's auctions:",e)}}function x(e=null){const n=document.getElementById("noResultsMessage");D.innerHTML="";const r=e||(I?[...b,...v]:b.length>0?b:v.slice(0,9));n&&(r.length===0?n.classList.remove("d-none"):n.classList.add("d-none")),r.forEach(t=>{var l,u,g,y;const s=((u=(l=t.media)==null?void 0:l[0])==null?void 0:u.url)||"https://images.pexels.com/photos/140134/pexels-photo-140134.jpeg",i=((y=(g=t.media)==null?void 0:g[0])==null?void 0:y.alt)||t.title,a=t.endsAt,d=t.bids||[],c=d.length?Math.max(...d.map(w=>w.amount)):0;D.innerHTML+=`
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm">
           <a href="/pages/auctionDetail.html?id=${t.id}">
            <img src="${s}" class="card-img-top object-fit-cover" style="height: 200px;" alt="${i}"
            onerror="this.onerror=null; this.src='https://images.pexels.com/photos/140134/pexels-photo-140134.jpeg';" /></a>
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${t.title}</h5>
              <p class="card-text">${t.description||"No description"}</p>
              <div class="mt-auto">
                <div class="d-flex justify-content-between">
                  <div>
                    <strong>Highest bid:</strong>
                    <div class="bid-amount">$${c}</div>
                  </div>
                  <div>
                    <strong>Time left:</strong>
                    <div class="countdown time-left" data-endsat="${a}">${q(a)}</div>
                  </div>
                </div>
                <div class="d-flex justify-content-between mt-3">
                  <button class="btn btn-primary fw-bold"
                    ${E?`data-bs-toggle="modal" data-bs-target="#bidModal" data-bid-id="${t.id}"`:"disabled"}>
                    ${E?"Bid":"Log in to bid"}
                  </button>
                  <a href="/pages/auctionDetail.html?id=${t.id}" class="btn btn-secondary fw-bold">
                    View
                  </a>
                </div> 
              </div>
            </div>
          </div>
        </div>
      `});const o=E?!I&&v.length>0:!I&&v.length>9;j.style.display=o?"block":"none"}function G(){return[...b,...v]}setInterval(()=>{document.querySelectorAll(".countdown").forEach(e=>{e.textContent=q(e.dataset.endsat)})},1e3);j.addEventListener("click",()=>{I=!0,x()});_();window.refreshListings=async function(){await _()};function V(e,n){switch(n){case"newest":return e.sort((r,o)=>new Date(o.created)-new Date(r.created));case"oldest":return e.sort((r,o)=>new Date(r.created)-new Date(o.created));case"endingSoon":return e.sort((r,o)=>new Date(r.endsAt)-new Date(o.endsAt));default:return e}}const $=document.getElementById("searchInput"),M=document.getElementById("sortSelect");$==null||$.addEventListener("input",R);M==null||M.addEventListener("change",R);async function R(){const e=$.value.toLowerCase(),n=M.value;try{const o=(await G()).filter(s=>{var d,c;const i=((d=s.title)==null?void 0:d.toLowerCase())||"",a=((c=s.description)==null?void 0:c.toLowerCase())||"";return i.includes(e)||a.includes(e)}),t=V(o,n);x(t)}catch(r){console.error("Error while searching/sorting:",r)}}async function Q(e,n,r,o){var a,d;const t=m("accessToken"),s=m("username");if(!t||!s){f("#bidMessageContainer","You must be logged in to place a bid.","danger");return}if(n<=r){f("#bidMessageContainer",`The bid must be higher than the highest bid. (${r} credits).`,"danger");return}const i={amount:Number(n)};T();try{const c=await fetch(`${p}/auction/listings/${e}/bids`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-Noroff-API-Key":h},body:JSON.stringify(i)}),l=await c.json();if(!c.ok)throw new Error(((d=(a=l.errors)==null?void 0:a[0])==null?void 0:d.message)||"Something went wrong");f("#bidMessageContainer"," Your bid has been placed!","success"),await L(s),typeof o=="function"||typeof window.refreshListings=="function"&&await window.refreshListings(),setTimeout(()=>{const u=document.getElementById("bidModal"),g=bootstrap.Modal.getInstance(u);g&&g.hide()},1500)}catch(c){f("#bidMessageContainer",`Couldn't send a message: ${c.message}`,"danger")}finally{B()}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("bidModal"),n=document.getElementById("bidForm"),r=document.getElementById("bidAmount"),o=document.getElementById("listingId");e.addEventListener("show.bs.modal",t=>{const s=t.relatedTarget,i=s==null?void 0:s.getAttribute("data-bid-id"),a=document.querySelector("#bidMessageContainer");a&&(a.innerHTML=""),r&&(r.value=""),i&&(o.value=i)}),n.addEventListener("submit",async t=>{var a,d;t.preventDefault();const s=o.value,i=Number(r.value);if(!s||!i){f("#bidMessageContainer"," Fill in bid amount.","error");return}try{const c=m("accessToken"),l=m("username"),g=await(await fetch(`${p}/auction/listings/${s}?_bids=true`,{headers:{Authorization:`Bearer ${c}`,"X-Noroff-API-Key":h}})).json(),y=(d=(a=g.data)==null?void 0:a.bids)!=null&&d.length?Math.max(...g.data.bids.map(w=>w.amount)):0;await Q(s,i,y)}catch(c){f("#bidMessageContainer",`Failed to retrieve bid information: ${c.message}`,"error")}})});
